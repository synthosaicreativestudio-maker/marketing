# Отладка проблемы с загрузкой акций

## Проблема
Акции не загружаются в Mini App, показывается ошибка "Не удалось загрузить акции" и "Failed to fetch".

## Что проверить

### 1. Проверить Google Apps Script URL
Откройте в браузере:
```
https://script.google.com/macros/s/AKfycbxLWWXHpDinqz0F6-Nkf1OBXv0IpHx66J3D-P_4MA5N5qSO8QmaJh5JlUjTYJuLUt0BBg/exec
```

**Ожидаемый результат:** JSON массив с акциями, например:
```json
[
  {
    "id": "...",
    "title": "Название акции",
    "description": "Описание",
    "status": "Активна",
    "start_date": "07.01.2026",
    "end_date": "31.01.2026"
  }
]
```

**Если видите ошибку:**
- Проверьте, что скрипт обновлен в Google Apps Script
- Проверьте, что в таблице есть акции со статусом "Активна"
- Проверьте логи в Google Apps Script (Выполнения → Журнал выполнения)

### 2. Проверить консоль браузера в Mini App

1. Откройте Mini App в Telegram
2. Нажмите F12 (или откройте DevTools)
3. Перейдите на вкладку Console
4. Посмотрите логи:
   - `Попытка загрузить акции с: ...`
   - `Ответ от ...`
   - Любые ошибки

### 3. Проверить таблицу Google Sheets

1. Откройте таблицу "Акции"
2. Убедитесь, что есть строки со статусом "Активна" в колонке D
3. Убедитесь, что заполнены:
   - Название (колонка B)
   - Описание (колонка C)
   - Статус = "Активна" (колонка D)

### 4. Проверить Google Apps Script

1. Откройте Google Apps Script
2. Убедитесь, что код из `GOOGLE_APPS_SCRIPT_FULL.js` вставлен
3. Сохраните (Ctrl+S)
4. Обновите развертывание:
   - "Развернуть" → "Управление развертываниями"
   - Иконка редактирования ✏️
   - "Новая версия"
   - "Развернуть"

### 5. Проверить логи на сервере

```bash
ssh ubuntu@158.160.0.127
sudo journalctl -u marketingbot-bot -f
```

Ищите ошибки связанные с promotions_api.

## Возможные причины

1. **Google Apps Script не обновлен** - нужно обновить развертывание
2. **Нет акций со статусом "Активна"** - проверьте таблицу
3. **CORS проблема** - Google Apps Script должен быть с доступом "Anyone"
4. **Неправильный формат данных** - проверьте, что скрипт возвращает массив

## Быстрое решение

1. Откройте URL Google Apps Script в браузере
2. Если видите JSON - всё работает, проблема в Mini App
3. Если видите ошибку - обновите скрипт в Google Apps Script
