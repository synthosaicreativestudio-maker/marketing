# Обновление существующего Google Apps Script

## Ситуация

У вас уже есть скрипт для управления акциями в Google Apps Script. Нужно добавить функцию `doGet` для получения акций через API, не нарушая существующую логику.

## Решение

Создан объединенный скрипт `google_apps_script_complete.js`, который содержит:
- ✅ Всю вашу существующую логику управления акциями
- ✅ Новую функцию `doGet` для API

## Как обновить существующий скрипт

### Вариант 1: Добавить только функцию doGet (рекомендуется)

1. Откройте ваш существующий скрипт в Google Apps Script
2. В конец файла добавьте функцию `doGet` из файла `google_apps_script_complete.js`
3. Найдите раздел `// ============================================================================`
4. Скопируйте всё, начиная с этого раздела до конца файла
5. Вставьте в конец вашего существующего скрипта
6. Сохраните (Ctrl+S)

### Вариант 2: Заменить весь скрипт

1. Откройте ваш существующий скрипт в Google Apps Script
2. Выделите весь код (Ctrl+A)
3. Удалите его
4. Откройте файл `google_apps_script_complete.js` из проекта
5. Скопируйте весь код
6. Вставьте в редактор Apps Script
7. Сохраните (Ctrl+S)

## Что добавлено

### Функция doGet

```javascript
function doGet(e) {
  // Получает активные акции из таблицы
  // Возвращает JSON с акциями со статусом "Активна"
  // Формат данных совместим с promotions_api.py
}
```

### Тестовая функция

```javascript
function testGetPromotions() {
  // Запустите эту функцию для проверки работы API
  // Результат будет в журнале выполнения
}
```

## Развертывание веб-приложения

После добавления функции `doGet`:

1. Нажмите **"Развернуть"** → **"Новое развертывание"**
2. Выберите тип: **"Веб-приложение"** (Web app)
3. В поле **"У кого есть доступ"** выберите **"Все"** (Anyone)
4. Нажмите **"Развернуть"**
5. Скопируйте URL веб-приложения

## Обновление существующего развертывания

Если у вас уже есть развертывание:

1. Нажмите **"Развернуть"** → **"Управление развертываниями"**
2. Нажмите на иконку редактирования ✏️ рядом с вашим развертыванием
3. Выберите **"Новая версия"** (New version)
4. Нажмите **"Развернуть"**

**Важно:** URL не изменится, изменения применятся автоматически.

## Проверка работы

1. Откройте скопированный URL в браузере
2. Вы должны увидеть JSON с активными акциями:

```json
[
  {
    "id": "Акция_1_...",
    "title": "Скидка 20% на все услуги",
    "description": "Специальное предложение",
    "status": "Активна",
    "start_date": "05.10.2025",
    "end_date": "31.10.2025"
  }
]
```

## Важно

- ✅ Существующая логика управления акциями не изменится
- ✅ Все триггеры продолжат работать
- ✅ Меню "Управление Акциями" останется
- ✅ Добавлена только функция `doGet` для API

## Структура скрипта

```
Ваш существующий код:
├── Конфигурация
├── onOpen()
├── setupSheet()
├── createTriggers()
├── onEditTrigger()
├── handlePublish()
├── handleFinish()
└── updateStatusesDaily()

Новый код (добавить):
├── doGet()          ← API функция
└── testGetPromotions()  ← Тестовая функция
```

---

**Версия:** 1.0  
**Дата:** 6 января 2026  
**Статус:** ✅ Готово к использованию
