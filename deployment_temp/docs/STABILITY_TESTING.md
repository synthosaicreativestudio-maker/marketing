# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞

## 1Ô∏è‚É£ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞ –Ω–∞ –ø–∞–¥–µ–Ω–∏–µ/–∑–∞—Å—ã–ø–∞–Ω–∏–µ?

### –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è (10 —Å–µ–∫—É–Ω–¥)
```bash
bash scripts/monitor_bot_health.sh
```

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
- ‚úÖ –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞ (active/inactive)
- ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0)
- ‚úÖ –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç
- ‚úÖ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å Event Loop
- ‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π —Ç–µ—Å—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ (24+ —á–∞—Å–∞)
```bash
bash scripts/long_term_stability_test.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ **10 –º–∏–Ω—É—Ç**
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ä–æ—Å—Ç –ø–∞–º—è—Ç–∏
- –°—á–∏—Ç–∞–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏
- –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ —Ñ–∞–π–ª `bot_stability_test_*.log`

**–ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –Ω–∞ 24 —á–∞—Å–∞ –≤ —Ñ–æ–Ω–µ
nohup bash scripts/long_term_stability_test.sh > /dev/null 2>&1 &

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥
tail -f bot_stability_test_*.log
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
| –ú–µ—Ç—Ä–∏–∫–∞ | –•–æ—Ä–æ—à–æ | –ü–ª–æ—Ö–æ |
|---------|--------|-------|
| –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏ | 0 | > 0 |
| –†–æ—Å—Ç –ø–∞–º—è—Ç–∏ | < 50MB –∑–∞ 24—á | > 100MB |
| Event Loop –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å | > 0 req/min | 0 req/min |
| –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ | 0 | > 5 –∑–∞ —á–∞—Å |

### –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —Ç–µ—Å—Ç (—Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç)
```bash
python scripts/stress_test.py
```

–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 20 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–æ—Ç—É –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ª–∏ Event Loop.

---

## 2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–∏—Ç–∏–∫–∏ –∑–∞—Å—ã–ø–∞–Ω–∏—è VM

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å VM –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞—Å—ã–ø–∞–Ω–∏–µ
```bash
bash scripts/check_vm_sleep_policy.sh
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
1. Cron –∑–∞–¥–∞—á–∏ –Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫—É/–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É
2. Systemd —Ç–∞–π–º–µ—Ä—ã
3. Uptime VM (—Å–∫–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏)
4. –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–æ–∫
5. –ü–æ–ª–∏—Ç–∏–∫–∞ –ø–∏—Ç–∞–Ω–∏—è
6. –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤—ã–∫–ª—é—á–µ–Ω–∏—è

### Yandex Cloud –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

**‚úÖ –•–æ—Ä–æ—à–∏–µ –Ω–æ–≤–æ—Å—Ç–∏:**
- Yandex Cloud VM **–ù–ï –∏–º–µ—é—Ç** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞—Å—ã–ø–∞–Ω–∏—è
- VM —Ä–∞–±–æ—Ç–∞–µ—Ç **24/7** –ø–æ–∫–∞ –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤—Ä—É—á–Ω—É—é
- –ù–µ—Ç "idle timeout" –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ suspend

**‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã "–∑–∞—Å—ã–ø–∞–Ω–∏—è":**

1. **–ü–∞–¥–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –±–æ—Ç–∞** ‚Üí systemd –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: `systemctl status marketingbot-bot.service`
   
2. **–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é –Ω–∞ VM**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: `ping -c 5 8.8.8.8` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
   
3. **–†—É—á–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ Yandex Console**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –∫–æ–Ω—Å–æ–ª–∏ Yandex Cloud
   
4. **–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –±–∏–ª–ª–∏–Ω–≥–∞/–∫–≤–æ—Ç**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –ë–∞–ª–∞–Ω—Å –≤ Yandex Cloud
   
5. **System OOM Killer —É–±–∏–ª –ø—Ä–æ—Ü–µ—Å—Å**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: `dmesg | grep -i 'killed process'`

---

## 3Ô∏è‚É£ –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è)

### –ü–ª–∞–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–∞ –ø–µ—Ä–≤—É—é –Ω–µ–¥–µ–ª—é

**–î–µ–Ω—å 1-2:** –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –ö–∞–∂–¥—ã–π —á–∞—Å –ø—Ä–æ–≤–µ—Ä—è—Ç—å
while true; do
  bash scripts/monitor_bot_health.sh
  sleep 3600
done
```

**–î–µ–Ω—å 3-7:** –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ –ª–∏—á–Ω—ã–π crontab (–Ω–∞ –õ–û–ö–ê–õ–¨–ù–û–ô –º–∞—à–∏–Ω–µ)
# –ü—Ä–æ–≤–µ—Ä–∫–∞ 4 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å
0 */6 * * * bash /path/to/marketingbot/scripts/monitor_bot_health.sh >> ~/bot_health.log 2>&1
```

**–î–µ–Ω—å 7+:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑ –≤ –¥–µ–Ω—å –≤—Ä—É—á–Ω—É—é
- –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏

### –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**Telegram –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:**
```bash
# –í —Å–∫—Ä–∏–ø—Ç–µ monitor_bot_health.sh –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –≤ Telegram
# –ï—Å–ª–∏ —Ç–µ—Å—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É
```

---

## 4Ô∏è‚É£ –ü—Ä–∏–∑–Ω–∞–∫–∏ –ø—Ä–æ–±–ª–µ–º

### ‚ùå –ë–æ—Ç —É–ø–∞–ª/–∑–∞–≤–∏—Å
**–°–∏–º–ø—Ç–æ–º—ã:**
- `systemctl status` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `inactive` –∏–ª–∏ `failed`
- NRestarts > 0
- Event Loop –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å = 0

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `sudo journalctl -u marketingbot-bot.service -n 100`
2. –ù–∞–π—Ç–∏ CRITICAL/ERROR
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å: `sudo systemctl restart marketingbot-bot.service`

### ‚ö†Ô∏è –£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏
**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–∞–º—è—Ç—å —Ä–∞—Å—Ç–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ (>100MB –∑–∞ 24—á)
- MemoryMonitor –ø–æ—Å—ã–ª–∞–µ—Ç WARNING

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à–∏ –≤ –∫–æ–¥–µ
2. –í—Ä–µ–º–µ–Ω–Ω–æ: –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
3. –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ: –∏—Å–ø—Ä–∞–≤–∏—Ç—å —É—Ç–µ—á–∫—É –≤ –∫–æ–¥–µ

### ‚ö†Ô∏è Event Loop –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
**–°–∏–º–ø—Ç–æ–º—ã:**
- getUpdates requests = 0
- –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ `RuntimeWarning: coroutine was never awaited`
2. –ù–∞–π—Ç–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã –≤ async —Ñ—É–Ω–∫—Ü–∏—è—Ö
3. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

–ü–æ—Å–ª–µ 7 –¥–Ω–µ–π —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –±–æ—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è **—Å—Ç–∞–±–∏–ª—å–Ω—ã–º**, –µ—Å–ª–∏:
- ‚úÖ NRestarts = 0
- ‚úÖ –ü–∞–º—è—Ç—å —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ (–Ω–µ —Ä–∞—Å—Ç–µ—Ç >10MB/–¥–µ–Ω—å)
- ‚úÖ Event Loop –∞–∫—Ç–∏–≤–µ–Ω 100% –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ < 1 –≤ –¥–µ–Ω—å

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å (–Ω–∞ –º–æ–º–µ–Ω—Ç –¥–µ–ø–ª–æ—è):**
- üü¢ SingleInstanceGuard –∞–∫—Ç–∏–≤–µ–Ω
- üü¢ –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω—ã
- üü¢ Event Loop —Ä–∞–±–æ—Ç–∞–µ—Ç (6 req/10sec)
- üü¢ –ü–∞–º—è—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–∞ (56.8M)
