# Техническая проблематика стабильности Telegram бота

## 1. Архитектура системы

### 1.1 Общая архитектура

Система представляет собой Telegram бота на базе `python-telegram-bot` (версия 20.7+), реализующего паттерн long polling для получения обновлений от Telegram API. Архитектура построена на модульном принципе с четким разделением ответственности между компонентами.

**Основные компоненты:**

```
┌─────────────────────────────────────────────────────────────┐
│                    Telegram Bot Application                  │
│  ┌───────────────────────────────────────────────────────┐  │
│  │  bot.py (Entry Point)                                 │  │
│  │  - Инициализация сервисов                            │  │
│  │  - Управление жизненным циклом                        │  │
│  │  - Signal handlers (SIGINT, SIGTERM)                 │  │
│  │  - Graceful shutdown                                  │  │
│  └───────────────────────────────────────────────────────┘  │
│                          │                                   │
│        ┌─────────────────┼─────────────────┐               │
│        │                 │                 │               │
│  ┌─────▼─────┐   ┌──────▼──────┐   ┌──────▼──────┐        │
│  │ handlers  │   │   Services  │   │  Monitors  │        │
│  │   .py     │   │             │   │            │        │
│  │           │   │ - Auth      │   │ - Response │        │
│  │ - /start  │   │ - Appeals   │   │ - Promo    │        │
│  │ - message │   │ - OpenAI    │   │ - Health   │        │
│  │ - webapp  │   │             │   │            │        │
│  └───────────┘   └─────────────┘   └────────────┘        │
└─────────────────────────────────────────────────────────────┘
                          │
        ┌─────────────────┼─────────────────┐
        │                 │                 │
┌───────▼───────┐  ┌──────▼──────┐  ┌──────▼──────┐
│ Google Sheets │  │  OpenAI API │  │ Telegram API│
│   (gspread)   │  │  (httpx)    │  │  (polling)  │
└───────────────┘  └─────────────┘  └─────────────┘
```

