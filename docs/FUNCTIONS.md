# Описание функций

## Основные функции бота

### TelegramBot.handle_start()
- **Назначение:** Обработка команды `/start` от пользователя
- **Входные параметры:** update (dict) - объект обновления от Telegram
- **Выходные данные:** None
- **Побочные эффекты:** Отправляет сообщение с кнопкой Web App пользователю
- **Ошибки/исключения:** Логирует ошибки при отправке сообщения
- **Примеры использования:** Автоматически вызывается при получении команды `/start`

### TelegramBot.send_message()
- **Назначение:** Отправка сообщения пользователю через Telegram Bot API
- **Входные параметры:** chat_id (int), text (str), reply_markup (dict, опционально)
- **Выходные данные:** dict - ответ от Telegram API
- **Побочные эффекты:** HTTP запрос к Telegram API
- **Ошибки/исключения:** requests.RequestException при проблемах с сетью
- **Примеры использования:** `bot.send_message(12345, "Привет!", keyboard)`

### TelegramBot.get_updates()
- **Назначение:** Получение обновлений от Telegram через long polling
- **Входные параметры:** None (использует self.offset)
- **Выходные данные:** dict - список обновлений от Telegram
- **Побочные эффекты:** HTTP запрос к Telegram API с timeout 30 сек
- **Ошибки/исключения:** requests.RequestException, timeout
- **Примеры использования:** Вызывается автоматически в цикле polling

## API функции

### webapp_auth()
- **Назначение:** Обработка запроса авторизации от веб-приложения
- **Входные параметры:** AuthRequest (init_data, partner_code, partner_phone)
- **Выходные данные:** dict - результат авторизации (ok, message, row, telegram_id)
- **Побочные эффекты:** Валидация данных, обновление Google Sheets, отправка уведомления
- **Ошибки/исключения:** HTTPException (400, 401, 404, 500)
- **Примеры использования:** POST /api/webapp/auth с JSON данными

### healthz()
- **Назначение:** Проверка состояния API сервера
- **Входные параметры:** None
- **Выходные данные:** dict {"status": "ok"}
- **Побочные эффекты:** None
- **Ошибки/исключения:** None
- **Примеры использования:** GET /healthz для мониторинга

## Веб-приложение функции

### doAuth() (JavaScript)
- **Назначение:** Отправка данных авторизации на API сервер
- **Входные параметры:** Данные из формы (код партнёра, телефон)
- **Выходные данные:** None (обновляет UI)
- **Побочные эффекты:** HTTP запрос к API, обновление сообщений на странице
- **Ошибки/исключения:** Показывает ошибки валидации и сети
- **Примеры использования:** Вызывается при нажатии кнопки "Авторизоваться"

### setMessage() (JavaScript)
- **Назначение:** Отображение сообщений пользователю в веб-приложении
- **Входные параметры:** text (string), isError (boolean)
- **Выходные данные:** None
- **Побочные эффекты:** Изменяет DOM элемент с сообщением
- **Ошибки/исключения:** None
- **Примеры использования:** `setMessage("Авторизация успешна", false)`

## Утилиты

### normalize_phone()
- **Назначение:** Нормализация номера телефона к единому формату
- **Входные параметры:** phone (str) - номер телефона в любом формате
- **Выходные данные:** str - нормализованный номер (например: "89827701055")
- **Побочные эффекты:** None
- **Ошибки/исключения:** None (возвращает пустую строку при ошибке)
- **Примеры использования:** `normalize_phone("+7 982 770-1055")` → `"89827701055"`

### validate_init_data()
- **Назначение:** Проверка подписи init_data от Telegram Web App
- **Входные параметры:** init_data (str), bot_token (str)
- **Выходные данные:** bool - True если подпись валидна
- **Побочные эффекты:** None
- **Ошибки/исключения:** None (возвращает False при ошибке)
- **Примеры использования:** `validate_init_data(initData, token)` → `True/False`
