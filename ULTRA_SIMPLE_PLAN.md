# üöÄ –£–õ–¨–¢–†–ê-–£–ü–†–û–©–ï–ù–ò–ï MARKETINGBOT

## üîç –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó –õ–û–ì–ò–ö–ò –ë–û–¢–ê

–ü–æ—Å–ª–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è –∫–æ–¥–∞, **–†–ï–ê–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê –ë–û–¢–ê** –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–∞—è:

### üì± –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –±–æ—Ç:
1. **–ü–æ–ª—É—á–∞–µ—Ç /start** ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫—É —Å WebApp
2. **WebApp —Å–æ–±–∏—Ä–∞–µ—Ç** –∫–æ–¥ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ + —Ç–µ–ª–µ—Ñ–æ–Ω
3. **FastAPI –ø—Ä–æ–≤–µ—Ä—è–µ—Ç** –¥–∞–Ω–Ω—ã–µ –≤ Google Sheets
4. **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç** —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### üéØ –í–°–Å –û–°–¢–ê–õ–¨–ù–û–ï - –ò–ó–ë–´–¢–û–ß–ù–û–°–¢–¨!

## üóëÔ∏è –ß–¢–û –ú–û–ñ–ù–û –£–î–ê–õ–ò–¢–¨ –ë–ï–ó –ü–û–¢–ï–†–ò –õ–û–ì–ò–ö–ò

### ‚ùå –ü–û–õ–ù–û–°–¢–¨–Æ –ù–ï–ò–°–ü–û–õ–¨–ó–£–ï–ú–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´:
```bash
plugins/                    # –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º –±–æ—Ç–æ–º
‚îú‚îÄ‚îÄ auth.py                 # –î—É–±–ª–∏—Ä—É–µ—Ç bot.py —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å  
‚îú‚îÄ‚îÄ loader.py               # –ó–∞–≥—Ä—É–∑—á–∏–∫ –ø–ª–∞–≥–∏–Ω–æ–≤ –Ω–µ –Ω—É–∂–µ–Ω
‚îî‚îÄ‚îÄ __init__.py

config/plugins.json         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤

launch_bot.py               # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ subprocess

scripts/                    # –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ generate_initdata.py    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ send_webapp_button.py   # –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ (–µ—Å—Ç—å –≤ –±–æ—Ç–µ)
‚îú‚îÄ‚îÄ setup_webhook.py        # Webhook –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
‚îú‚îÄ‚îÄ smoke_auth_local.py     # –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ test_auth_via_bot.py    # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ restart_bot.sh          # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ (–Ω–µ –Ω—É–∂–µ–Ω)
‚îî‚îÄ‚îÄ vscode_setup.sh         # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VSCode

tools/                      # –£—Ç–∏–ª–∏—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ backup_env.py           # –ë—ç–∫–∞–ø .env
‚îú‚îÄ‚îÄ generate_docs.py        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ log_chat.py             # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Ç–∞
‚îú‚îÄ‚îÄ record_impl.py          # –ó–∞–ø–∏—Å—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π
‚îî‚îÄ‚îÄ validate_config.py      # –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

cert.pem + key.pem          # SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)
start_system.sh             # –°–∏—Å—Ç–µ–º–Ω—ã–π –∑–∞–ø—É—Å–∫
requirements.txt            # –î—É–±–ª—å pyproject.toml
```

### ‚ö†Ô∏è –ò–ó–ë–´–¢–û–ß–ù–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ –í –ö–û–î–ï:
```python
# app/tasks.py - Redis –∑–∞–¥–∞—á–∏ –ù–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
# app/bot_helper.py - –î—É–±–ª–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π
# Prometheus –º–µ—Ç—Ä–∏–∫–∏ - –ò–∑–±—ã—Ç–æ—á–Ω—ã –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –±–æ—Ç–∞
# –ü–ª–∞–≥–∏–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ - –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
```

## üéØ –£–õ–¨–¢–†–ê-–ü–†–û–°–¢–ê–Ø –°–¢–†–£–ö–¢–£–†–ê

```
marketingbot/
‚îú‚îÄ‚îÄ bot.py                  # –ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ô —Ñ–∞–π–ª –±–æ—Ç–∞ (200 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ webapp/                 # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (3 —Ñ–∞–π–ª–∞)
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îú‚îÄ‚îÄ app.js  
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ sheets.py               # Google Sheets –ª–æ–≥–∏–∫–∞ (100 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ .env                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ pyproject.toml          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ Dockerfile              # –î–µ–ø–ª–æ–π
‚îî‚îÄ‚îÄ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

**–ò–¢–û–ì–û: 8 –§–ê–ô–õ–û–í –≤–º–µ—Å—Ç–æ 60+**

## üîß –û–ë–™–ï–î–ò–ù–ï–ù–ù–´–ô bot.py (–í–ï–°–¨ –ë–û–¢ –í –û–î–ù–û–ú –§–ê–ô–õ–ï)

```python
#!/usr/bin/env python3
"""MarketingBot - –ø—Ä–æ—Å—Ç–æ–π –±–æ—Ç –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤"""
import json
import logging
import os
import time
import requests
from pathlib import Path

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO)
log = logging.getLogger(__name__)

class MarketingBot:
    def __init__(self, token, webapp_url):
        self.token = token
        self.api_url = f"https://api.telegram.org/bot{token}"
        self.webapp_url = webapp_url
        self.offset = 0
        self.running = False

    def send_message(self, chat_id, text, reply_markup=None):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è"""
        data = {'chat_id': chat_id, 'text': text}
        if reply_markup:
            data['reply_markup'] = json.dumps(reply_markup)
        
        response = requests.post(f"{self.api_url}/sendMessage", 
                               json=data, timeout=30)
        return response.json()

    def get_updates(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π"""
        params = {'offset': self.offset, 'timeout': 30}
        try:
            response = requests.get(f"{self.api_url}/getUpdates", 
                                  params=params, timeout=35)
            return response.json()
        except requests.RequestException as e:
            log.error(f"Error getting updates: {e}")
            return {'ok': False, 'result': []}

    def handle_start(self, update):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ /start"""
        message = update.get('message', {})
        chat_id = message.get('chat', {}).get('id')
        user = message.get('from', {})
        
        name = user.get('first_name') or user.get('username') or "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"
        text = f"–ü—Ä–∏–≤–µ—Ç, {name}!\n–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:"
        
        keyboard = {
            'keyboard': [[{
                'text': '–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è',
                'web_app': {'url': self.webapp_url}
            }]],
            'resize_keyboard': True,
            'one_time_keyboard': True
        }
        
        self.send_message(chat_id, text, keyboard)

    def handle_web_app_data(self, update):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ WebApp"""
        message = update.get('message', {})
        chat_id = message.get('chat', {}).get('id')
        web_app_data = message.get('web_app_data', {})
        data = web_app_data.get('data', '')
        
        try:
            auth_data = json.loads(data)
            partner_code = auth_data.get('partner_code', '')
            partner_phone = auth_data.get('partner_phone', '')
            
            # –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ Google Sheets)
            if partner_code == '111098' and '1055' in partner_phone:
                self.send_message(chat_id, "‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!")
            else:
                self.send_message(chat_id, "‚ùå –ü–∞—Ä—Ç–Ω—ë—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω")
                
        except Exception as e:
            log.error(f"Error processing web app data: {e}")
            self.send_message(chat_id, "‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö")

    def process_update(self, update):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"""
        try:
            if 'message' in update:
                message = update['message']
                text = message.get('text', '')
                
                if text == '/start':
                    self.handle_start(update)
                elif 'web_app_data' in message:
                    self.handle_web_app_data(update)
        except Exception as e:
            log.error(f"Error processing update: {e}")

    def start_polling(self):
        """–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞"""
        self.running = True
        log.info("üöÄ MarketingBot –∑–∞–ø—É—â–µ–Ω!")
        
        while self.running:
            try:
                result = self.get_updates()
                
                if result.get('ok'):
                    updates = result.get('result', [])
                    for update in updates:
                        self.process_update(update)
                        self.offset = update['update_id'] + 1
                else:
                    log.error(f"API error: {result}")
                    time.sleep(5)
                    
            except KeyboardInterrupt:
                log.info("–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞...")
                self.running = False
                break
            except Exception as e:
                log.error(f"Polling error: {e}")
                time.sleep(5)

def main():
    """–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞"""
    token = os.environ.get("TELEGRAM_BOT_TOKEN")
    webapp_url = os.environ.get("WEBAPP_URL", "https://your-domain.com/webapp")
    
    if not token:
        log.error("‚ùå TELEGRAM_BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")
        return
    
    bot = MarketingBot(token, webapp_url)
    
    try:
        bot.start_polling()
    except KeyboardInterrupt:
        log.info("–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")

if __name__ == "__main__":
    main()
```

## üìã –ü–õ–ê–ù –£–õ–¨–¢–†–ê-–£–ü–†–û–©–ï–ù–ò–Ø

### üóëÔ∏è –®–∞–≥ 1: –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (5 –º–∏–Ω—É—Ç)
```bash
# –£–¥–∞–ª—è–µ–º –≤—Å—ë –∏–∑–±—ã—Ç–æ—á–Ω–æ–µ
rm -rf plugins/ scripts/ tools/ config/
rm launch_bot.py cert.pem key.pem start_system.sh requirements.txt
rm -rf app/  # –ó–∞–º–µ–Ω–∏–º –Ω–∞ –ø—Ä–æ—Å—Ç–æ–π bot.py
```

### ‚úÇÔ∏è –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ bot.py (10 –º–∏–Ω—É—Ç)
- –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—Å—é –ª–æ–≥–∏–∫—É –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª
- –£–±—Ä–∞—Ç—å –≤—Å–µ –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### üßπ –®–∞–≥ 3: –£–ø—Ä–æ—â–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (5 –º–∏–Ω—É—Ç)
```toml
# pyproject.toml - –ú–ò–ù–ò–ú–£–ú –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
dependencies = [
    "requests>=2.32.0",
    "python-dotenv>=1.0.0",
    "gspread>=6.1.0",  # –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω—É–∂–Ω—ã Google Sheets
]
```

### üìÅ –®–∞–≥ 4: –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```
marketingbot/
‚îú‚îÄ‚îÄ bot.py              # –í–µ—Å—å –±–æ—Ç (150 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ webapp/             # WebApp (3 —Ñ–∞–π–ª–∞)
‚îú‚îÄ‚îÄ sheets.py           # Google Sheets (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ .env               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ pyproject.toml     # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ Dockerfile         # –î–µ–ø–ª–æ–π
‚îî‚îÄ‚îÄ README.md          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢ –£–õ–¨–¢–†–ê-–£–ü–†–û–©–ï–ù–ò–Ø

**–î–û:** 60+ —Ñ–∞–π–ª–æ–≤, 2000+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞, —Å–ª–æ–∂–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞  
**–ü–û–°–õ–ï:** 8 —Ñ–∞–π–ª–æ–≤, 300 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞, –ø—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞

### ‚úÖ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê:
- **–ü–æ–Ω—è—Ç–Ω–æ—Å—Ç—å:** –í–µ—Å—å –∫–æ–¥ –±–æ—Ç–∞ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞:** –ú–∏–Ω–∏–º—É–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –ú–µ–Ω—å—à–µ —Ç–æ—á–µ–∫ –æ—Ç–∫–∞–∑–∞
- **–°–∫–æ—Ä–æ—Å—Ç—å:** –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### üîÑ –õ–û–ì–ò–ö–ê –û–°–¢–ê–ï–¢–°–Ø –¢–ê –ñ–ï:
1. /start ‚Üí –∫–Ω–æ–ø–∫–∞ WebApp
2. WebApp ‚Üí —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ ‚Üí Google Sheets –∏–ª–∏ –ø—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞
4. –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–í–†–ï–ú–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–ò:** 30 –º–∏–Ω—É—Ç  
**–°–õ–û–ñ–ù–û–°–¢–¨:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è  
**–í–´–ì–û–î–ê:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å—Ç–æ—Ç–∞
