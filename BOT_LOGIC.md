# Логика работы бота

Этот документ описывает высокоуровневую логику и основные сценарии взаимодействия с ботом.

## Основная цель

Бот предназначен для авторизации партнеров/сотрудников с использованием их корпоративных данных (код партнера, телефон) через Google Таблицу. После успешной авторизации бот должен предоставлять доступ к основной функциональности (будет определена позже).

## Сценарий 1: Авторизация нового пользователя

1.  **Инициация:** Пользователь, неавторизованный в системе, отправляет боту команду `/start`.
2.  **Проверка статуса:** Бот через `AuthService` проверяет, есть ли Telegram ID пользователя в Google Таблице и имеет ли он статус "Авторизован".
3.  **Ответ бота:**
    *   Поскольку пользователь не авторизован, бот отправляет приветственное сообщение с предложением пройти авторизацию.
    *   К сообщению прикрепляется inline-кнопка "Авторизоваться".
4.  **Переход в Mini App:**
    *   Пользователь нажимает на кнопку.
    *   Открывается веб-приложение (Mini App), загруженное по `WEB_APP_URL` (файл `index.html`).
5.  **Ввод данных:**
    *   В Mini App пользователь вводит свой "Код партнера" и "Телефон партнера из КОСМОС".
    *   Нажимает кнопку "Авторизоваться" внутри веб-приложения.
6.  **Отправка данных боту:**
    *   JavaScript в `index.html` собирает данные из полей и отправляет их боту через `Telegram.WebApp.sendData()`.
7.  **Обработка данных:**
    *   Бот получает данные через `web_app_data_handler`.
    *   Обработчик вызывает `AuthService` для поиска пользователя в Google Таблице по коду и телефону.
8.  **Результат обработки:**
    *   **Успех:** Если совпадение найдено, `AuthService` обновляет строку в таблице (ставит статус "Авторизован", добавляет Telegram ID и дату). Бот отправляет пользователю сообщение об успешной авторизации.
    *   **Неудача:** Если совпадение не найдено, бот отправляет сообщение об ошибке и снова предлагает пройти авторизацию с помощью кнопки.

## Сценарий 2: Взаимодействие с авторизованным пользователем

1.  **Инициация:** Пользователь, который уже успешно прошел авторизацию, отправляет команду `/start`.
2.  **Проверка статуса:** Бот через `AuthService` проверяет статус пользователя и обнаруживает, что он "Авторизован".
3.  **Ответ бота:** Бот отправляет приветствие и (в будущем) главное меню с доступом к основной функциональности. Запрос на авторизацию больше не показывается.