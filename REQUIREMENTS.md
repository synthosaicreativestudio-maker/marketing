# Основные требования к чат-боту "Marketing Bot"

## 1. Общая цель
Бот предназначен для авторизации партнеров/сотрудников с использованием их корпоративных данных (код партнера, телефон) через Google Таблицу и предоставления доступа к основной функциональности после успешной авторизации.

## 2. Функциональные требования

### 2.1. Авторизация пользователя (v0.1.0 - текущая версия)
*   **Инициация:** Пользователь отправляет команду `/start`.
*   **Проверка статуса:** Бот должен проверять статус авторизации пользователя в Google Таблице по Telegram ID.
*   **Приветствие:**
    *   **Неавторизованный пользователь:** Бот отправляет приветственное сообщение с предложением пройти авторизацию и Inline-кнопкой "Авторизоваться".
    *   **Авторизованный пользователь:** Бот отправляет приветствие (в будущем — главное меню) без предложения авторизации.
*   **Mini App для авторизации:**
    *   При нажатии на кнопку "Авторизоваться" открывается Mini App (`index.html`).
    *   Mini App должно содержать поля для ввода "Кода партнера" и "Телефона партнера из КОСМОС".
    *   Mini App должно отправлять введенные данные боту через `Telegram.WebApp.sendData()` в формате JSON.
*   **Обработка данных авторизации:**
    *   Бот должен получать данные из Mini App и вызывать `AuthService` для их обработки.
    *   `AuthService` должен искать пользователя в Google Таблице по "Коду партнера" и "Телефону партнера".
    *   **Успешная авторизация:** Если пользователь найден, `AuthService` обновляет его статус на "Авторизован", добавляет Telegram ID и текущую дату в Google Таблицу. Бот отправляет сообщение об успешной авторизации.
    *   **Неудачная авторизация:** Если пользователь не найден, бот отправляет сообщение об ошибке и снова предлагает пройти авторизацию с помощью кнопки.

### 2.2. Основной функционал (v1.0.0 - планируется)
*   **Главное меню:** Для авторизованных пользователей должно быть реализовано интерактивное меню.
*   **Система подачи заявок:**
    *   Создание нового Mini App для заполнения формы заявки.
    *   Сохранение данных заявок во вторую Google Таблицу (`TICKETS_SHEET_URL`).
*   **Уведомления для администратора:** Отправка уведомлений на `ADMIN_TELEGRAM_ID` о ключевых событиях (например, новая заявка, ошибка).

### 2.3. Интеллектуальные функции (v2.0.0 - дальнейшее развитие)
*   **Интеграция с OpenAI Assistant:** Подключение OpenAI Assistant для ответов на вопросы и обработки текста.
*   **Аналитика и отчеты:** Функционал для сбора статистики и генерации отчетов.
*   **Расширенное управление пользователями:** Создание админ-панели (возможно, Mini App) для управления пользователями и их правами.

## 3. Нефункциональные требования

### 3.1. Производительность
*   Проверка статуса авторизации должна быть эффективной, используя прямой поиск по листу Google Таблицы.

### 3.2. Безопасность
*   Конфиденциальные данные (токены, ключи API) должны храниться в файле `.env`.
*   Доступ к Google Таблицам должен осуществляться через `credentials.json` с соответствующими правами.

### 3.3. Расширяемость и модульность
*   Проект должен иметь модульную структуру (сервисы `GoogleSheetsService`, `AuthService`, `handlers`).

### 3.4. Удобство использования
*   Интерфейс Mini App должен быть простым и интуитивно понятным для ввода данных.

### 3.5. Надежность
*   Бот должен быть устойчив к ошибкам и предоставлять обратную связь пользователю в случае неудачной авторизации.

### 3.6. Управляемость
*   Должны быть предусмотрены механизмы для запуска, остановки и перезапуска бота.
*   Должна быть возможность отслеживать статус локального репозитория и синхронизировать изменения с удаленным репозиторием GitHub.